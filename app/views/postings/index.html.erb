<div id='fb-root'></div>
<div class='row-fluid'>
  <div class='span9 main-area'>
    <div class="search-area">
      <%= form_tag(postings_path,:method=>:get) do%>
        <%if current_user%>
      <%= link_to "Post",new_posting_path, :class=>"btn"%>
      <%end%>
        <%=text_field_tag "search[name]",(params[:search].present? ? params[:search][:name]: ''), :class=>"input-medium search-query span6", :placeholder=>"Search"%>
        <%=submit_tag "Search" , :class=>'btn btn-info'%>
      <% end %>
      <hr>
    </div>
    
    <%@postings.each do |posting|%>
      <div id="post_<%=posting.id%>">
        <%if current_user%>
          <%if current_user.uid==posting.user_id%>
            <div class="offset11">
              <%= link_to image_tag("edit.png",:size=>"10x16"),edit_posting_path(posting)%>
              <%= link_to image_tag("delete.png",:size=>"10x16"),posting_path(posting), :method =>:delete%>
            </div>
            <div class="clearfix"></div>
          <%end%>  
        <%end%>
        <ul class="thumbnails">
          <h5><%= posting.user_name%></h5>
          <h3><%= posting.caption%></h3>
          <%@pictures = posting.pictures%>
          <%@pictures.each do |picture|%>
            <li class="span4">
              <div class="thumbnail">
                <%= image_tag(picture.image_url,:style=>"width:300px;height:200px;")%>
              </div>
            </li>
          <%end%>
          <div class="clearfix"></div>
          <p><%= posting.post%></p>          
        </ul>
        <a href="#" id="like">Like</a>|<a href="#" id='comment'>Comment</a>|<a href="#" onclick='postToFeed(); return false;'>Share</a>
      </div>
      <br>
      <div class='span12 comment-area-<%=posting.id%>'>
        <hr style="margin: 20px 38px 20px -25px;">
        <%posting.comments.each do |comment|%>
          <div class="row-fluid">
          <div id="comment+<%=comment.id%>" class="span10">
            <b><%=comment.user_name%></b>
            <%=comment.content%>
            
            <hr>
          </div>
          <%if current_user%>
            <%if current_user.uid==posting.user_id%>
              <div class="span2">
                <%= link_to image_tag("edit.png",:size=>"10x16"),edit_posting_comment_path(posting,comment)%>
                <%= link_to image_tag("delete.png",:size=>"10x16"),posting_comment_path(posting,comment), :method =>:delete%>
            </div>
            <%end%>
          <%end%>
          </div>
          
            
        <%end%>
        <%if current_user%>
          <%=form_for([posting,@comment=posting.comments.new], :method=>:post,:url=>create_comment_path(posting,@comment)) do |f|%>
            <%=f.text_field :content,:style=>"margin-bottom: 0px;"%>
            <%=f.hidden_field :user_id, :value=>current_user.uid%>
            <%=f.hidden_field :user_name, :value=>current_user.name%>
            <%=f.hidden_field :commented_on, :value=>Time.now%>
            <%=f.submit "Add Comment",:class=>"btn btn-success"%>
          <%end%>
        <%end%>
      </div>      
    <%end%>
  </div>  
<div class='recent-activities span3'>
  <%if not current_user%>
    <a href="/auth/facebook"><%= image_tag "fb.png" %></a><br><br>
    <a href="/auth/facebook"><%= image_tag "twitter.png" %></a>
  <%end%>
  <%= paginate @activities%>
  <% @activities.each do |activity| %>
  <%= activity.owner.name if activity.owner %>
  <%= render_activity activity %>
  <% end %>
</div>
<div class="clearfix"></div>






   
 

    <script> 
      FB.init({appId: "140476016130992", status: true, cookie: true});

      function postToFeed() {
        
        // calling the API ...
        var obj = {
          method: 'feed',
          redirect_uri: 'http://localhost:3000/',
          link: 'https://localhost:3000',
          picture: "http://localhost:3000"+"<%#=post.image_url%>",
          name: 'India',
          caption: '<%#=post.caption%>',
          description: '<%#=post.post%>'
        };

        function callback(response) {
          document.getElementById('msg').innerHTML = "Post ID: " + response['post_id'];
        }

        FB.ui(obj, callback);
      }
    
    </script>
